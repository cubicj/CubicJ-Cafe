import { PrismaClient } from '@prisma/client';

// Prisma Client ì‹±ê¸€í†¤ íŒ¨í„´
const globalForPrisma = globalThis as unknown as {
  prisma: PrismaClient | undefined;
};

export const prisma =
  globalForPrisma.prisma ??
  new PrismaClient({
    log: process.env.NODE_ENV === 'production' ? ['error'] : ['error'],
  });

if ((process.env.NODE_ENV || 'development') !== 'production') globalForPrisma.prisma = prisma;

// ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° í…ŒìŠ¤íŠ¸
export async function testDatabaseConnection() {
  try {
    await prisma.$connect();
    console.log('âœ… ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì„±ê³µ');
    return true;
  } catch (error) {
    console.error('âŒ ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì‹¤íŒ¨:', error);
    return false;
  }
}

// ì• í”Œë¦¬ì¼€ì´ì…˜ ì¢…ë£Œ ì‹œ ì—°ê²° í•´ì œ
export async function disconnectDatabase() {
  await prisma.$disconnect();
  console.log('ğŸ”Œ ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° í•´ì œ');
}